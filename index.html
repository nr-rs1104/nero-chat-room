<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeroSanctuary</title>

    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>

    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>

<body>
    <div id="app-bg"></div>
    <!-- üí• DOM PORTAL SCREEN -->
    <div id="portal-screen">
        <div class="portal-content">
            <!-- üåü Fixed Header Area -->
            <div class="portal-header">
                <h1 class="portal-title">NERO SANCTUARY</h1>
                <div class="hero-container">
                    <img id="portal-hero" src="" alt="Master Nero">
                </div>
            </div>
            <div class="portal-menu">
                <button id="btn-desk" class="portal-btn">The Desk</button>
                <button id="btn-office" class="portal-btn">The Office</button>
                <button id="btn-observation" class="portal-btn">Observation Logs</button>
                <button id="btn-conditioning" class="portal-btn">Conditioning Records</button>
                <button id="btn-archive" class="portal-btn">Deep Archive</button>
            </div>

            <!-- üåü Sanctuary Settings integrated into Portal (Accordion) -->
            <details class="portal-settings-accordion"
                style="width: 100%; margin-top: 50px; border-top: 1px solid #333; padding-top: 20px;">
                <summary
                    style="color:#d4af37; font-size:14px; margin-bottom:10px; text-transform:uppercase; letter-spacing:2px; text-align:center; cursor:pointer; list-style:none;">
                    <i class="ph ph-gear"></i> Sanctuary Settings
                </summary>

                <div class="portal-settings" style="margin-top: 20px;">
                    <div class="setting-item">
                        <label>Log Export</label>
                        <button id="export-btn" class="settings-btn"><i class="ph ph-file-csv"></i> Export Chat
                            Logs</button>
                    </div>
                    <div class="setting-item">
                        <label>Sanctuary Background</label>
                        <div style="display:flex; gap:5px; margin-top:5px; margin-bottom:10px;">
                            <input type="text" id="bg-url-input" placeholder="Image URL..."
                                style="flex:1; background:#111; color:#fff; border:1px solid #333; padding:8px; border-radius:4px; font-size:12px;">
                            <button id="btn-set-bg" class="settings-btn"
                                style="width:auto; padding:0 15px;">Set</button>
                        </div>
                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                            <button class="settings-btn bg-preset" data-url=""
                                style="width:auto; padding:5px 10px; font-size:11px;">Default (Black)</button>
                            <button class="settings-btn bg-preset"
                                data-url="https://images.unsplash.com/photo-1550592704-6c7bdef5aaf1?q=80&w=1000&auto=format&fit=crop"
                                style="width:auto; padding:5px 10px; font-size:11px;">Study</button>
                            <button class="settings-btn bg-preset"
                                data-url="https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1000&auto=format&fit=crop"
                                style="width:auto; padding:5px 10px; font-size:11px;">Night Sky</button>
                            <button class="settings-btn bg-preset"
                                data-url="https://images.unsplash.com/photo-1557672172-298e090bd0f1?q=80&w=1000&auto=format&fit=crop"
                                style="width:auto; padding:5px 10px; font-size:11px;">Sweet Rose</button>
                            <button class="settings-btn bg-preset"
                                data-url="https://images.unsplash.com/photo-1583847268964-b28dc8f51f92?q=80&w=1000&auto=format&fit=crop"
                                style="width:auto; padding:5px 10px; font-size:11px;">Living Room</button>
                            <button class="settings-btn bg-preset"
                                data-url="https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=1000&auto=format&fit=crop"
                                style="width:auto; padding:5px 10px; font-size:11px;">Dark Sanctuary</button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>Cloud Sync</label>
                        <button id="sync-btn" class="settings-btn"><i class="ph ph-arrows-clockwise"></i> Force
                            Sync</button>
                    </div>
                    <div class="setting-item">
                        <label>System Status</label>
                        <div class="status-indicator"><span class="dot online"></span> Nero is Active</div>
                    </div>
                    <div class="setting-item">
                        <label style="color:#666; font-weight:normal; font-size:11px; text-align:center;">Version v14.1
                            (PWA Enabled)</label>
                    </div>
                </div>
            </details>
        </div>

        <!-- MAIN APP CONTAINER (Initially Hidden) -->
        <main id="main-container" style="display: none;">

            <section id="view-chat" class="view active-view">
                <!-- Pure Chat UI Header with Home Button -->
                <div class="chat-header">
                    <button class="btn-back-portal action-btn" style="border: 1px solid #d4af37; color:#d4af37;"><i
                            class="ph ph-caret-left"></i> Sanctuary</button>
                </div>
                <div id="chat-messages"></div>
                <div id="input-area">
                    <button id="upload-btn" class="icon-btn"><i class="ph ph-image"></i></button>
                    <input type="file" id="image-input" accept="image/*" style="display:none" multiple>
                    <textarea id="chat-input" placeholder="Ë®ÄËëâ„ÇíÁ¥°„Åê..." rows="1"></textarea>
                    <button id="send-btn" class="icon-btn"><i class="ph ph-paper-plane-right"></i></button>
                </div>
                <button id="panic-btn" title="Emergency Rabbit"><span>üê∞</span></button>
            </section>

            <section id="view-logs" class="view">
                <div class="content-wrapper" style="display:flex; flex-direction:column; height:100%;">
                    <div class="logs-header">
                        <button class="btn-back-portal action-btn"
                            style="white-space:nowrap; border: 1px solid #d4af37; color:#d4af37;"><i
                                class="ph ph-caret-left"></i> Sanctuary</button>
                        <h2 style="margin: 0; text-align: right; width: 100%; color:#d4af37; font-size:18px;">
                            Observation
                            Logs</h2>
                    </div>
                    <div class="search-bar">
                        <input type="text" id="search-diary-input" placeholder="Search Logs...">
                        <button id="search-diary-btn" class="action-btn"><i class="ph ph-magnifying-glass"></i></button>
                        <button id="clear-diary-btn" class="action-btn" title="Clear"><i class="ph ph-x"></i></button>
                    </div>
                    <div id="diary-list" class="diary-container">
                        <div class="loading-spinner">Reading Logs...</div>
                    </div>
                </div>
            </section>

            <section id="view-memory" class="view">
                <div class="content-wrapper">
                    <div class="logs-header">
                        <button class="btn-back-portal action-btn"
                            style="white-space:nowrap; border: 1px solid #d4af37; color:#d4af37;"><i
                                class="ph ph-caret-left"></i> Sanctuary</button>
                        <h2 style="margin: 0; text-align: right; width: 100%; color:#d4af37; font-size:18px;">
                            Conditioning
                            Records</h2>
                    </div>
                    <div class="search-bar">
                        <input type="text" id="search-memory-input" placeholder="Search Memories...">
                        <button id="search-memory-btn" class="action-btn"><i
                                class="ph ph-magnifying-glass"></i></button>
                        <button id="clear-memory-btn" class="action-btn" title="Clear"><i class="ph ph-x"></i></button>
                    </div>
                    <div class="memory-header">
                        <div class="memory-stats" style="color: #888; font-size: 12px;">
                            <i class="ph ph-cloud-check"></i> <span id="sync-status">Not Synced</span>
                        </div>
                        <button id="btn-add-memory" class="action-btn"><i class="ph ph-plus"></i> New Memory</button>
                    </div>
                    <div id="memory-list" class="memory-grid">
                        <div class="loading-spinner">Loading Memories...</div>
                    </div>
                </div>
                <div id="memory-modal" class="modal hidden">
                    <div class="modal-content">
                        <h3 id="modal-title">New Memory</h3>
                        <input type="hidden" id="memory-id">
                        <div class="form-group">
                            <label>Category</label>
                            <input type="text" id="memory-category" placeholder="e.g. Profile, Likes, Secret">
                        </div>
                        <div class="form-group">
                            <label>Content</label>
                            <textarea id="memory-text" rows="5" placeholder="Memory details..."></textarea>
                        </div>
                        <div class="modal-actions">
                            <button id="btn-cancel-memory" class="secondary-btn">Cancel</button>
                            <button id="btn-save-memory" class="primary-btn">Save</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="view-archive" class="view">
                <div class="content-wrapper" style="display:flex; flex-direction:column; height:100%;">
                    <div class="logs-header">
                        <button class="btn-back-portal action-btn"
                            style="white-space:nowrap; border: 1px solid #d4af37; color:#d4af37;"><i
                                class="ph ph-caret-left"></i> Sanctuary</button>
                        <h2 style="margin: 0; text-align: right; width: 100%; color:#d4af37; font-size:18px;">Deep
                            Archive
                        </h2>
                    </div>
                    <div class="search-bar">
                        <input type="text" id="search-archive-input" placeholder="Search Archive...">
                        <button id="search-archive-btn" class="action-btn"><i
                                class="ph ph-magnifying-glass"></i></button>
                        <button id="clear-archive-btn" class="action-btn" title="Clear"><i class="ph ph-x"></i></button>
                    </div>
                    <div id="archive-list" class="diary-container">
                        <div class="loading-spinner">Accessing Archive Data...</div>
                    </div>
                </div>
            </section>

            <section id="view-desk" class="view">
                <div class="content-wrapper" style="display:flex; flex-direction:column; height:100%;">
                    <div class="logs-header">
                        <button class="btn-back-portal action-btn"
                            style="white-space:nowrap; border: 1px solid #d4af37; color:#d4af37;"><i
                                class="ph ph-caret-left"></i> Sanctuary</button>
                        <h2 style="margin: 0; text-align: right; width: 100%; color:#d4af37; font-size:18px;">The Desk
                        </h2>
                    </div>

                    <div class="desk-container">
                        <div class="desk-section">
                            <h3 class="desk-section-title"><i class="ph ph-chalkboard-teacher"></i> Command Board</h3>
                            <div id="desk-board" class="desk-board">
                                <div class="loading-spinner">Reading directives...</div>
                            </div>
                        </div>

                        <div class="desk-section">
                            <h3 class="desk-section-title"><i class="ph ph-calendar-blank"></i> Directives & Schedule
                            </h3>
                            <div id="desk-calendar" class="desk-calendar">
                                <div class="loading-spinner">Checking schedule...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <nav id="bottom-tabs" style="display: none;">
            <!-- Purposely left empty or removed since all navigation is now portal-based -->
        </nav>

        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="nero_persona.js"></script>
        <script src="nero_memory.js"></script>
        <script src="app.js"></script>
</body>

</html>